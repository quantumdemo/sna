{% extends "base.html" %}

{% block title %}Student Dashboard{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Welcome Area -->
    <section class="welcome-area">
        <div class="profile-pic">
            <img src="{{ url_for('static', filename='profile_pics/' + current_user.profile_pic) }}" alt="Profile Picture">
        </div>
        <div class="greeting">
            <h1>Welcome back, {{ current_user.name }}!</h1>
            <p>"The beautiful thing about learning is that no one can take it away from you." - B.B. King</p>
        </div>
    </section>

    <!-- Quick Indicators -->
    <section class="quick-indicators">
        <div class="glass-card indicator-card">
            <div class="indicator-icon"><i class="fas fa-book-open"></i></div>
            <div class="indicator-text">
                <span class="indicator-value">{{ active_courses_count }}</span>
                <span class="indicator-label">Active Courses</span>
            </div>
        </div>
        <div class="glass-card indicator-card">
            <div class="indicator-icon"><i class="fas fa-check-circle"></i></div>
            <div class="indicator-text">
                <span class="indicator-value">{{ completed_courses_count }}</span>
                <span class="indicator-label">Completed Courses</span>
            </div>
        </div>
        <div class="glass-card indicator-card">
            <div class="indicator-icon"><i class="fas fa-certificate"></i></div>
            <div class="indicator-text">
                <span class="indicator-value">{{ certificates_count }}</span>
                <span class="indicator-label">Certificates Earned</span>
            </div>
        </div>
        <div class="glass-card indicator-card">
            <div class="indicator-icon"><i class="fas fa-envelope"></i></div>
            <div class="indicator-text">
                <span class="indicator-value">{{ unread_messages_count }}</span>
                <span class="indicator-label">New Messages</span>
            </div>
        </div>
    </section>

    <!-- Browse Courses Section -->
    <section class="course-section">
        <h2 class="section-title">Browse Your Courses</h2>
        <div class="dashboard-grid">
            {% for data in enrollment_data %}
                {% set enrollment = data.enrollment %}
                {% set progress = data.progress %}
                <div class="glass-card course-card">
                    <div class="course-card-image" style="background-image: url('{{ url_for('static', filename='images/course_placeholder.jpg') }}');"></div>
                    <div class="course-card-content">
                        <h3 class="course-title">{{ enrollment.course.title }}</h3>
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: {{ progress.percentage | default(0) }}%;"></div>
                        </div>
                        <div class="card-footer">
                            <span class="status-badge status-{{ 'completed' if progress.can_request_certificate else 'ongoing' }}">
                                {{ 'Completed' if progress.can_request_certificate else 'Ongoing' }}
                            </span>
                            {% if progress.can_request_certificate %}
                                <a href="#" class="btn-glow request-cert-btn">Request Certificate</a>
                            {% else %}
                                <a href="{{ url_for('main.course_detail', course_id=enrollment.course.id) }}" class="btn-glow">Continue</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% else %}
                <p>You are not enrolled in any courses yet. <a href="{{ url_for('main.courses') }}">Browse courses</a> to get started.</p>
            {% endfor %}
        </div>
    </section>

    <!-- Browse Library Section -->
    <section class="library-section">
        <h2 class="section-title">Browse Library</h2>
        <div class="dashboard-grid">
            {% for purchase in library_purchases %}
                {% if purchase.status == 'approved' %}
                <div class="glass-card library-card">
                    <div class="library-card-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="library-card-content">
                        <h3 class="library-title">{{ purchase.material.title }}</h3>
                        <p class="library-category">{{ purchase.material.category.name if purchase.material.category else 'General' }}</p>
                    </div>
                    <a href="{{ url_for('main.download_library_material', material_id=purchase.material.id) }}" class="btn-glow">View / Open</a>
                </div>
                {% endif %}
            {% else %}
                <p>You have not purchased any library materials yet. <a href="{{ url_for('main.library') }}">Visit the library</a>.</p>
            {% endfor %}
        </div>
    </section>
</div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script>
        document.body.classList.add('dashboard-body');
    </script>
{% endblock %}

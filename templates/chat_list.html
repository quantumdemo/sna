{% extends "base.html" %}

{% block title %}Chat Rooms{% endblock %}

{% block content %}
<div class="ice-sky-content">
    <div class="chat-list-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h1>Chat Rooms</h1>
        <a href="{{ url_for('main.create_group') }}" class="btn-primary">Create New Group</a>
    </div>

    <div class="search-bar-container glassy-card-container" style="margin-bottom: 2rem; padding: 1rem;">
        <input type="text" id="search-input" placeholder="Search chat rooms..." class="form-input">
    </div>

    <ul class="room-card-list" style="list-style: none; padding: 0;">
        {% for room in rooms %}
        <li class="room-card glassy-card-container" data-room-id="{{ room.id }}" data-room-name="{{ room.name | lower }}" style="display: flex; align-items: center; gap: 15px; margin-bottom: 1rem; cursor: pointer;">
            <div class="room-card-avatar" style="width: 50px; height: 50px; border-radius: 50%; background-color: #0288d1; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem; color: white; flex-shrink: 0;">
                {% if room.cover_image %}
                    <img src="{{ url_for('static', filename=room.cover_image) }}" alt="{{ room.name }}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
                {% else %}
                    <span>{{ room.name[0] | upper }}</span>
                {% endif %}
            </div>
            <div class="room-card-info" style="flex-grow: 1;">
                <h3>{{ room.name }}</h3>
                <p>{{ room.description or 'No description available.' }}</p>
            </div>
            <div class="room-card-meta" style="display: flex; align-items: center; gap: 15px;">
                <span class="member-count">{{ room.member_count }} members</span>
                {% if room.unread_count > 0 %}
                <span class="missed-message-counter" style="background-color: #29b6f6; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem;">{{ room.unread_count }}</span>
                {% endif %}
            </div>
        </li>
        {% else %}
        <p class="glassy-card-container">You don't have access to any chat rooms yet.</p>
        {% endfor %}
    </ul>

    <a href="{{ url_for('main.create_group') }}" class="btn-primary" style="position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; text-decoration: none; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">+</a>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    const roomCards = document.querySelectorAll('.room-card');

    // Live search functionality
    searchInput.addEventListener('keyup', function() {
        const searchTerm = searchInput.value.toLowerCase();
        roomCards.forEach(card => {
            const roomName = card.dataset.roomName;
            if (roomName.includes(searchTerm)) {
                card.style.display = 'flex';
            } else {
                card.style.display = 'none';
            }
        });
    });

    // Click to enter chat room
    roomCards.forEach(card => {
        card.addEventListener('click', function() {
            const roomId = this.dataset.roomId;
            window.location.href = `/chat/${roomId}`;
        });
    });
});
</script>
{% endblock %}

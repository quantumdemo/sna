{% extends "base.html" %}

{% block title %}Manage Library{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>Library Management</h1>
        <p>Review, approve, and manage all library materials.</p>
    </div>

    <!-- Search and Filter Bar -->
    <div class="filter-bar">
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="Search for materials..." class="input-glassy" style="border-radius: 9999px; padding-left: 2.5rem;">
        </div>
        <div class="filter-dropdowns">
            <select name="category" class="input-glassy">
                <option value="">All Categories</option>
                <!-- Populate categories from DB -->
            </select>
            <select name="status" class="input-glassy">
                <option value="">All Statuses</option>
                <option value="approved">Approved</option>
                <option value="pending">Pending</option>
                <option value="rejected">Rejected</option>
            </select>
        </div>
    </div>

    <!-- Library Items Grid -->
    <div class="admin-grid library-grid">
        {% for item in all_materials %}
        <div class="glass-card library-item-card">
            <div class="item-thumbnail">
                <!-- Placeholder for thumbnail, e.g., first page of a PDF -->
                <img src="{{ url_for('static', filename='images/course_placeholder.jpg') }}" alt="{{ item.title }} thumbnail">
                <span class="item-price">â‚¦{{ item.price_naira }}</span>
            </div>
            <div class="card-body">
                <h3 class="card-title">{{ item.title }}</h3>
                <p class="card-subtitle">by {{ item.uploader.name }}</p>
                <div class="item-status">
                     {% if not item.approved and not item.rejection_reason %}
                        <span class="status-badge pending">Pending</span>
                    {% elif item.rejection_reason %}
                        <span class="status-badge banned">Rejected</span>
                    {% else %}
                        <span class="status-badge approved">Approved</span>
                    {% endif %}
                </div>
            </div>
            <div class="card-footer">
                {% if not item.approved and not item.rejection_reason %}
                    <form action="{{ url_for('admin.approve_library_material', material_id=item.id) }}" method="post" style="display: inline;">
                        <button type="submit" class="btn-primary-glass compact-btn">Approve</button>
                    </form>
                    <button class="btn-secondary-glass compact-btn">Reject</button>
                {% endif %}
                 <form action="{{ url_for('admin.delete_library_material', material_id=item.id) }}" method="post" style="display: inline;">
                    <button type="submit" class="btn-secondary-glass compact-btn"><i class="fas fa-trash"></i></button>
                </form>
            </div>
        </div>
        {% else %}
            <div class="glass-card full-width-card">
                <p>No library materials found.</p>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

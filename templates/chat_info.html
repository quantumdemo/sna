{% extends "base.html" %}

{% block title %}{{ room.name }} - Info{% endblock %}

{% block content %}
<div class="ice-sky-content">
    <div class="info-header glassy-card-container" style="text-align: center; margin-bottom: 2rem;">
        <a href="{{ url_for('main.chat_room', room_id=room.id) }}" class="btn-primary" style="float: left;">Back to Chat</a>
        <h1>{{ room.name }}</h1>
        <p>{{ room.description }}</p>
    </div>

    <div class="grid-container" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; padding: 1rem;">
        <div class="info-card glassy-card-container">
            <h3>Members ({{ room.members.count() }})</h3>
            <ul class="members-list" style="list-style: none; padding: 0;">
                {% for member in room.members.limit(10) %}
                <li style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <img src="{{ url_for('static', filename='profile_pics/' + member.user.profile_pic) }}" alt="{{ member.user.name }}" class="member-avatar" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 1rem; object-fit: cover;">
                    <span>{{ member.user.name }}</span>
                </li>
                {% endfor %}
            </ul>
            {% if user_role_in_room == 'admin' %}
            <a href="{{ url_for('main.add_members', room_id=room.id) }}" class="btn-primary">Add Members</a>
            {% endif %}
        </div>

        <div class="info-card glassy-card-container">
            <h3>Shared Media</h3>
            <div class="media-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 1rem;">
                {% for message in media_messages %}
                    {% if message.file_path and message.file_name.lower().endswith(('png', 'jpg', 'jpeg', 'gif')) %}
                    <div class="media-item">
                        <img src="{{ url_for('static', filename=message.file_path) }}" alt="Shared media" style="width: 100%; height: 100px; object-fit: cover; border-radius: 8px;">
                    </div>
                    {% endif %}
                {% else %}
                    <p>No media has been shared yet.</p>
                {% endfor %}
            </div>
        </div>

        {% if user_role_in_room == 'admin' %}
        <div class="info-card glassy-card-container">
            <h3>Admin Actions</h3>
            <a href="{{ url_for('main.edit_group_icon', room_id=room.id) }}" class="btn-primary">Change Group Icon</a>
            <hr style="margin: 1rem 0; border-color: rgba(255,255,255,0.2);">
            <p>Danger Zone</p>
            <form action="{{ url_for('admin.delete_chat_room', room_id=room.id) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this group? This action cannot be undone.');">
                <button type="submit" class="btn-danger" style="background-color: #ef4444; color: white; padding: 0.75rem 1.5rem; border-radius: 50px; text-decoration: none; border: none; font-weight: 700;">Delete Group</button>
            </form>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

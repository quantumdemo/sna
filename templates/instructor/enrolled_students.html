{% extends "base.html" %}

{% block title %}Enrolled Students{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>Enrolled Students for: <em>{{ course.title }}</em></h1>
        <a href="{{ url_for('instructor.manage_course', course_id=course.id) }}" class="btn-secondary-glass">&laquo; Back to Course Management</a>
    </div>

    <div class="glassy-table-wrapper">
        <div class="glassy-table">
            <div class="table-header" style="grid-template-columns: 1fr 3fr;">
                <div class="table-cell">Student</div>
                <div class="table-cell">Submissions & Grading</div>
            </div>
            {% for student in course.students %}
            <div class="table-row-card">
                <div class="table-row" style="grid-template-columns: 1fr 3fr; align-items: start;">
                    <div class="table-cell" data-label="Student">
                        <strong>{{ student.name }}</strong>
                        <span class="user-email">{{ student.email }}</span>
                    </div>
                    <div class="table-cell" data-label="Submissions">
                        <ul class="submission-list-compact">
                            {% for module in course.modules.order_by('order') %}
                                {% if module.assignment %}
                                    <li>
                                        <strong>{{ module.assignment.title }}:</strong>
                                        {% set submission = student.assignment_submissions.filter_by(assignment_id=module.assignment.id).first() %}
                                        {% if submission %}
                                            Submitted (Grade: {{ submission.grade or 'N/A' }})
                                            <form action="{{ url_for('instructor.grade_submission', submission_id=submission.id) }}" method="post" class="inline-grade-form">
                                                <input type="text" name="grade" placeholder="A+" class="input-glassy compact-input">
                                                <button type="submit" class="btn-primary-glass compact-btn">Grade</button>
                                            </form>
                                        {% else %}
                                            <em>Not Submitted</em>
                                        {% endif %}
                                    </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="glass-card full-width-card">
                <p>No students are currently enrolled in this course.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
<style>
.submission-list-compact {
    list-style: none;
    padding: 0;
}
.submission-list-compact li {
    padding: 1rem;
    border-radius: 8px;
    background: rgba(255,255,255,0.1);
    margin-bottom: 0.5rem;
}
.inline-grade-form {
    display: inline-flex;
    gap: 0.5rem;
    align-items: center;
    margin-left: 1rem;
}
.compact-input {
    padding: 0.25rem 0.5rem;
    border-radius: 8px !important;
    width: 80px;
}
</style>
{% endblock %}

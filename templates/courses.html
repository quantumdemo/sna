{% extends "base.html" %}

{% block title %}Explore Our Courses{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/courses.css') }}">
{% endblock %}

{% block content %}
<div class="courses-page-container">
    <!-- 1. Hero Section -->
    <section class="courses-hero">
        <div class="hero-content">
            <h1 class="hero-title">Explore Our Courses</h1>
            <p class="hero-subtitle">Learn, grow, and unlock opportunities with world-class courses.</p>
            <div class="hero-search-wrapper">
                <form action="{{ url_for('main.courses') }}" method="get" class="hero-search-form">
                    <input type="text" name="search" class="input-glassy" placeholder="What do you want to learn today?" value="{{ request.args.get('search', '') }}" style="border-radius: 9999px;">
                    <button type="submit" class="btn-primary-glass" style="padding: 0.8rem 1.5rem;"><i class="fas fa-search"></i></button>
                </form>
            </div>
        </div>
    </section>

    <!-- Mobile Filter Toggle -->
    <button class="mobile-filter-toggle">
        <i class="fas fa-filter"></i> Filters
    </button>

    <!-- Main Content Layout -->
    <div class="courses-layout">
        <!-- 2. Filter Panel -->
        <aside class="filters-panel-wrapper">
            <div class="filters-panel form-container-glassy" style="padding: 2rem; margin: 0;">
                <h3 class="filter-title">Filters</h3>
                <form action="{{ url_for('main.courses') }}" method="get">
                    <!-- Search inside filter panel -->
                    <div class="form-group">
                        <label for="search-filter" class="filter-label">Search</label>
                        <input type="text" id="search-filter" name="search" placeholder="Search by title..." class="input-glassy" value="{{ request.args.get('search', '') }}">
                    </div>

                    <!-- Category Filters -->
                    <div class="form-group">
                        <label class="filter-label">Category</label>
                        <div class="category-pills">
                            {% for category in categories %}
                                <div class="pill-option">
                                    <input type="checkbox" id="cat-{{ category.id }}" name="category" value="{{ category.id }}" {% if category.id|string in request.args.getlist('category') %}checked{% endif %}>
                                    <label for="cat-{{ category.id }}">{{ category.name }}</label>
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Price Filters -->
                    <div class="form-group">
                        <label class="filter-label">Price Range (₦)</label>
                        <div class="price-inputs">
                            <input type="number" name="min_price" placeholder="Min" class="input-glassy" value="{{ request.args.get('min_price', '') }}">
                            <input type="number" name="max_price" placeholder="Max" class="input-glassy" value="{{ request.args.get('max_price', '') }}">
                        </div>
                    </div>

                    <button type="submit" class="btn-primary-glass" style="width: 100%; margin-top: 1rem;">Apply Filters</button>
                </form>
            </div>
        </aside>

        <!-- 3. Course Display Grid -->
        <main class="course-grid-container">
            <div class="course-grid">
                {% if courses.items %}
                    {% for course in courses.items %}
                    <div class="course-card-item glass-card">
                        <div class="course-thumbnail" style="background-image: url('{{ url_for('static', filename='images/' + (course.cover_image or 'course_placeholder.jpg')) }}');"></div>
                        <div class="course-card-content">
                            <h4 class="course-card-title">{{ course.title }}</h4>
                            <p class="course-card-desc">{{ course.description | truncate(100) }}</p>
                            <div class="course-card-footer">
                                <span class="price-badge">₦{{ "{:,.0f}".format(course.price_naira) }}</span>
                                <a href="{{ url_for('main.course_detail', course_id=course.id) }}" class="btn-primary-glass compact-btn">View Course <i class="fas fa-arrow-right"></i></a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="no-courses-found">No courses found that match your criteria.</p>
                {% endif %}
            </div>

            <!-- 4. Pagination -->
            <div class="pagination-container">
                {% if courses.has_prev %}
                    <a href="{{ url_for('main.courses', page=courses.prev_num, **request.args) }}" class="pagination-arrow prev">&laquo;</a>
                {% endif %}

                <div class="page-numbers">
                    {% for page_num in courses.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                        {% if page_num %}
                            <a href="{{ url_for('main.courses', page=page_num, **request.args) }}" class="page-number {{ 'active' if page_num == courses.page else '' }}">{{ page_num }}</a>
                        {% else %}
                            <span class="page-ellipsis">...</span>
                        {% endif %}
                    {% endfor %}
                </div>

                {% if courses.has_next %}
                    <a href="{{ url_for('main.courses', page=courses.next_num, **request.args) }}" class="pagination-arrow next">&raquo;</a>
                {% endif %}
            </div>
        </main>
    </div>
</div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script>
        document.body.classList.add('courses-body');
    </script>
    <script src="{{ url_for('static', filename='js/courses.js') }}"></script>
{% endblock %}

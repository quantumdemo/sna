{% extends "base.html" %}

{% block title %}Exam Appeal{% endblock %}

{% block content %}
<div class="ice-sky-content">
    <div class="glassy-card-container">
        <div class="form-header text-center">
            <h1 class="form-title">Exam Locked: {{ submission.final_exam.course.title }}</h1>
            <p>Your exam has been locked due to a suspected violation (e.g., leaving the exam tab).</p>
        </div>

        <div class="violation-details">
            <h3>Violation Log</h3>
            {% if submission.violations.all() %}
                <ul>
                    {% for violation in submission.violations %}
                        <li>{{ violation.timestamp.strftime('%Y-%m-%d %H:%M:%S') }} UTC: {{ violation.details }}</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No specific violation details recorded.</p>
            {% endif %}
        </div>

        <hr style="border-color: rgba(255,255,255,0.2); margin: 2rem 0;">

        {% if submission.appeal_status == 'pending' %}
            <div class="alert alert-info">Your appeal is currently pending review by the instructor.</div>
        {% elif submission.appeal_status == 'accepted' %}
            <div class="alert alert-success">Your appeal was accepted. The instructor has been notified to manually review your case.</div>
        {% elif submission.appeal_status == 'rejected' %}
            <div class="alert alert-danger">
                Your appeal was rejected.
                {% if submission.instructor_remarks %}
                    <p><strong>Instructor Remarks:</strong> {{ submission.instructor_remarks }}</p>
                {% endif %}
            </div>
        {% else %}
            <div class="form-header text-center">
                <h3 class="form-title" style="font-size: 1.8rem;">Submit an Appeal</h3>
                <p>If you believe this was a mistake, you can submit an appeal to your instructor for review.</p>
            </div>
            <form action="{{ url_for('main.submit_appeal', submission_id=submission.id) }}" method="post">
                <div class="form-group">
                    <label for="appeal_text" class="form-label">Your Explanation:</label>
                    <textarea name="appeal_text" id="appeal_text" rows="5" required placeholder="Please explain why the violation occurred (e.g., unstable internet connection, accidental click, etc.)." class="form-input"></textarea>
                </div>
                <div class="form-actions text-center">
                    <button type="submit" class="btn-primary">Submit Appeal</button>
                </div>
            </form>
        {% endif %}

        <div style="margin-top: 20px; text-align: center;">
            <a href="{{ url_for('main.student_dashboard') }}" class="btn-primary">Back to Dashboard</a>
        </div>
    </div>
</div>

<style>
.violation-details {
    background: rgba(255,255,255,0.1);
    padding: 1.5rem;
    border-radius: 12px;
}
.alert {
    padding: 1rem;
    border-radius: 12px;
    text-align: center;
    font-weight: 600;
}
.alert-info { background: rgba(59, 130, 246, 0.2); color: #dbeafe;}
.alert-success { background: rgba(34, 197, 94, 0.2); color: #dcfce7;}
.alert-danger { background: rgba(239, 68, 68, 0.2); color: #fee2e2;}
</style>
{% endblock %}
